---
layout:       post
title:        "ICP 的分散可验证随机性：利用阈值加密法实现公平与安全"
author:       "TQ2050"
header-style: text
catalog:      true
tags:
    - Web
    - JavaScript
---

> ICP 的阈值加密技术确保去中心化应用具有安全、不可预测的随机性，克服了传统区块链在公平性和可验证性方面的弱点。

每周ICP资讯订阅 | Twitter | 网站
关键要点
真正的去中心化，无需中介： ICP的链上随机性消除了对像Chainlink VRF这样的第三方服务的依赖，提供完全去中心化、无需信任且具成本效益的随机数生成。
不可预测、无法篡改的随机性： 通过使用阈值BLS签名和可验证随机函数（VRF），ICP确保生成的随机数既不可预测，又可验证。
下一代DApp的关键： 游戏、彩票、NFT生成和DAO治理都受益于ICP的透明链上随机性，推动更公平、更值得信任的应用程序。
减少操控和偏见风险： 与传统区块链不同，矿工无法操控时间戳或区块哈希，ICP的随机性仅在区块确认后最终确定，从而防止操控行为。
驱动DeFi、游戏和AI创新的催化剂： 像World Lottery这样的项目展示了ICP的随机性如何支持创新，推动去中心化应用的新场景。
解决区块链随机性问题： ICP确保真正的随机性，避免了传统方法中的可预测性和操控问题。
什么是随机性？
随机性是指一系列事件中没有任何模式或可预测性。在我们的日常生活中，掷骰子或抛硬币是随机性的简单例子。然而，在计算机和区块链的世界里，生成真正的随机性要复杂得多。某个事件如果“看起来是随机的”还不够，它还必须是可以证明的不可预测和安全的。

随机性是区块链和加密学的重要支柱。它使得安全的密钥生成、验证者的随机选择、彩票抽奖、NFT属性等成为可能。没有可靠的随机性，去中心化系统将容易受到剥削和操控。主要的随机数应用场景包括：

密钥生成：用于加密和解密的加密密钥必须是不可预测的。如果密钥生成背后的随机性较弱，攻击者可以预测并破坏密钥。
共识机制：随机性用于在某些区块链共识协议中随机选择区块验证者或领导者，确保公平性和去中心化。
游戏和彩票：在线游戏和彩票抽奖依靠随机性来确保公平性。如果随机性可以预测或控制，它就会给某些玩家带来不公平的优势。
NFT生成：一些NFT的属性是随机分配的，公平随机性确保所有参与者获得稀有道具的机会均等。
区块链中的伪随机数
与此密切相关的概念是伪随机性，它是通过算法生成的随机数。大多数PoS区块链（包括以太坊2.0）使用伪随机数（PRN）而非真正的随机数。做出这一选择的主要原因在于区块链系统的特性以及去中心化、效率和可验证性的要求。

去中心化和无需信任真正的随机性通常通过专用硬件（如硬件随机数生成器）或外部随机性提供者生成，这引入了对外部实体的依赖，这与区块链的去中心化原则相悖。通过使用像RANDAO这样的链上方法生成伪随机数，以太坊2.0确保没有单一的参与者或第三方控制该过程。
可验证性和透明性真正的随机性很难验证，因为这需要引入额外的信任方。区块链参与者需要能够独立验证随机性。通过像RANDAO或VRF这样的方式生成的伪随机数可以在链上完全验证。任何人都可以看到并验证生成随机数的过程，这增强了透明度和信任。
性能和效率生成真正的随机数需要更多的计算资源和专用硬件，这可能会拖慢区块链的操作。伪随机数在链上生成时计算成本较低，从而可以更快、更高效地进行区块生产和共识。
伪随机数在以太坊2.0等主流区块链中发挥着至关重要的作用。然而，这些网络的分散性在产生随机性方面带来了独特的挑战。虽然伪随机数可能看起来是随机的，但从技术上讲，它们是从特定的种子或初始值生成的。这意味着，如果种子是已知的，数列就可以被复制。传统的方法，比如依赖于块哈希，往往容易受到操纵。

DApp中生成随机性的方式
DApp，尤其是在彩票、NFT生成和游戏等用例中，需要以去中心化、可验证且无法篡改的方式利用随机性。伪随机数在区块链中得到了广泛应用，因为它们的生成方式允许可追溯性和可验证性，这是去中心化环境中的关键特性。

以下是DApp生成随机性的三种主要方法，每种方法都有其优势、局限性和应用：

方法1：使用预言机（链外随机性）像Chainlink VRF这样的预言机为智能合约提供链外随机性。Chainlink VRF使用加密函数在链外生成一个随机数，并将其连同加密证明一起返回给区块链。

优势

高安全性：随机性使用加密安全方法生成。
可验证性：智能合约可以独立验证随机性的有效性。
不可预测性：没有参与者（包括预言机）可以预测结果。
挑战

信任假设：尽管是可验证的，用户仍然需要信任预言机服务。
成本：依赖链外预言机服务会产生gas费和服务费用。
方法2：利用区块链中的伪随机性这种方法利用区块链数据中的固有随机性，如区块哈希、时间戳或验证者选择，作为随机性来源。

优势

去中心化：不需要外部服务提供商（如预言机）来生成随机性。
成本效益：因为随机性来源于现有的区块链数据，所以无需额外费用。
可用性：每个验证者或矿工都可以参与随机性生成。
挑战

可预测性：如果验证者在提交前能看到即将到来的随机值，他们可能会故意延迟或影响最终的随机性（“最后揭示者”问题）。
被利用的风险：矿工或验证者可能操控区块哈希，以实现有利的随机抽取结果。
方法3：使用智能合约生成链上随机性智能合约可以利用区块链特有的数据，如区块哈希、时间戳或交易哈希，生成随机数。

优势

简单性：不需要链外服务或参与者贡献。
链上验证：随机性是透明的，可以直接在链上验证。
低成本：智能合约使用现有区块链数据生成随机性，因此没有额外的服务费用。
挑战

信任假设：对开发者来说较为复杂，可能引入信任假设。
获取区块链中的伪随机性
为去中心化应用（DApps）获取随机性的理想方法应当优化利用区块链中的伪随机性。它必须避免引入新的信任假设或依赖第三方服务，确保强大的去中心化、成本效益和可验证性。此外，还应降低被利用的风险和可预测性，确保随机生成过程保持不可预测性、防篡改性和可验证性。在随机性起着重要作用的系统中，节点和验证者可以利用随机性生成的确定性特征为自己谋取利益：

随机性通常依赖于区块哈希、时间戳或加密签名等输入。
矿工可以在广播区块之前计算出与其区块相关的伪随机结果。如果结果不满意，他们可能会选择不广播该区块，等待其他矿工生成带有不同随机种子的区块。
让我们从最初开始讨论区块链中（以以太坊为例）如何通过链上的交易签名来实现这一过程。以下是信息传递的简要流程图。信息传递涉及区块链网络中不同组件之间的通信，包括节点、用户和外部服务。当用户通过钱包或前端应用程序发起交易时，交易数据通过API传递到网络中。



根据流程图，整个过程可以分为五个阶段，每个阶段都有可能影响PoS区块链中随机性的透明性、不可预测性和可操控性。让我们详细讨论每个阶段：

交易创建与签名
交易由用户（EOA账户）或像MetaMask这样的钱包创建并签名。在此阶段，用户在其钱包中本地生成交易，可能涉及转账或调用智能合约等操作。签名交易时，用户使用其私钥通过加密算法（如ECDSA）签署交易数据（例如，目标地址、金额、nonce）。这些算法依赖于随机的私钥或本地生成的随机数来生成签名。由于随机性在客户端本地生成，因此区块生产者无法对该过程产生影响。

2. 交易广播与传播

签名后的交易会通过P2P网络广播并由节点接收，交易被放入内存池（mempool）。验证者从内存池中收集这些交易，决定哪些交易将包含在下一个区块中。广播阶段不依赖于随机性，因为节点仅作为中介将交易传播到网络中。

3. 交易收集与排序

验证者从内存池中选择交易并确定其在区块中的顺序。验证者可能故意操控交易顺序，例如通过最大可提取价值（MEV）来优先处理对自己有利的交易。尽管这个过程涉及验证者的裁量权，但它反映的是故意选择而非真正的随机性。

4. 区块提议与创建

验证者作为区块生产者创建区块，并控制时间戳、交易排序和区块哈希。这些元素可以作为去中心化应用（DApps）中的随机性输入。

区块时间戳： 尽管时间戳是单调递增的，验证者可以稍微调整它（例如，±几秒）。这可能会影响某些链上行为，例如那些依赖基于时间的随机性的应用（例如，基于block.timestamp生成NFT特征）。
交易数据与哈希： 一些DApp（如区块链彩票）使用block.hash、block.timestamp或block.number等值作为随机性来源。区块生产者可以部分控制这些值。
区块哈希： 区块哈希是通过对区块头进行哈希运算得出的，区块头包括时间戳、Merkle根和交易顺序等组件。验证者可以调整这些输入（例如，交易顺序或时间戳），以影响最终的区块哈希，从而影响依赖于它的应用程序的随机性结果。
5. 区块验证与链上确认

区块创建后，会被网络中的验证者和节点验证并确认。在此阶段，区块的随机性来源（包括哈希和时间戳）已被最终确定且不可更改。任何从这些元素派生的随机性都已设定，进一步的操控变得不可能。

从上述过程来看，区块生产者可以预见特定区块链设计中的伪随机结果（通过Mempool中的数据），因为用于生成随机性的许多加密和计算过程具有确定性。在许多区块链中，伪随机值来自区块链系统中可用的确定性输入。输入种子包括：

区块哈希： 区块或前一个区块的哈希通常作为随机性的种子。由于矿工生成区块并计算其哈希，他们可以预测结果。
交易数据： 特定的交易细节（例如，时间戳、地址）可能作为输入。如果矿工将这些交易包含在他们的区块中，他们可以预测由这些交易派生的随机性。
加密签名： PoS区块链可能从数字签名或类似的加密数据中派生随机性。签署区块的区块创建者可以计算并预测伪随机结果。如果结果不利于他们的利益，他们可能选择使用不同的数据重新签署该区块，或者拒绝发布该区块，重新尝试使用更好的配置。
如果结果是不利的，他们可能会选择用不同的数据重新签名块，或者拒绝发布它，用更好的配置重新尝试。具体行为如下：

延迟区块发布： 区块创建者可以评估由区块派生的伪随机结果（例如，通过哈希或包含特定数据）。如果结果不利于他们的利益（例如，输掉一场赌注或影响质押选择），他们可能会选择不发布该区块。这样就只会有对他们有利的区块传播到网络中。
注入偏差： 节点可以有选择地制作交易或数据输入，并将其包含在他们的区块中，从而影响伪随机结果。例如，在PoS区块链中，随机性种子可能来源于签名、哈希值或其他确定性派生的数据，允许攻击者定制区块。
串通： 由单一实体或实体联盟控制的多个节点可以协调选择性地传播或丢弃区块，从而放大他们操控随机性的能力。
ICP链上的随机数算法如何解决这些问题
ICP的随机性系统基于阈值BLS签名方案，通过可验证随机函数（VRF）生成与特定共识轮次相关的随机数。

工作原理在ICP中，随机性通过去中心化和加密安全的过程生成，确保了公平性和可信度。该机制的核心依赖于VRF，它生成与特定输入确定性相关的随机输出。VRF确保这些输出不可预测、无法篡改且可验证，非常适合用于去中心化应用。

随机性生成过程与网络的共识机制紧密集成。在每一轮共识过程中，子网节点协作生成随机性。每个节点使用其私钥计算部分签名，直到足够数量的节点（满足阈值2/3以上）贡献它们的部分签名，这些签名将合并成一个阈值签名。该阈值签名被哈希处理，生成与当前轮次和共识状态密切相关的随机值，确保随机性是唯一且去中心化的，消除了对单一信任点的依赖。

生成的随机性被封装在一个“随机信标”中，作为伪随机数生成器（PRNG）“随机带”的种子。这个随机带生成为之前请求随机性的智能合约（Canisters）提供独特的随机值。随机带中的随机值在区块最终完成之前是无法看到的。通过将输出与下一轮共识绑定，ICP 防止了当前随机性被用于预测未来输出的可能性，从而增强了系统的安全性和完整性。

开发者可以通过管理模块或编程模块（如Motoko的Random模块）提供的api访问这种随机性。这个过程是异步的，与网络的共识轮保持一致。例如，在Motoko中，开发人员可以简单地调用一个函数来获取与当前回合相关的随机性，以便在他们的应用程序中使用。这确保了智能合约可以以直接有效的方式纳入安全随机性。

对上述过程进行简单概述，ICP在链上产生随机数的主要过程如下：

节点贡献：子网节点使用阈值加密技术独立生成加密共享。这些共享共同代表一个共享的秘密（随机性），对某些恶意节点具有容错能力。
阈值签名创建：当有足够数量的节点（如三分之二）贡献时，它们的份额被聚合成一个阈值签名，形成核心随机性值。
随机值生成：将阈值签名散列以产生分散的随机值。这个值被封装在一个随机信标中，这确保了它是不可预测和防篡改的。
集成共识和随机磁带：
随机信标作为称为随机磁带的伪随机数生成器（PRNG）的种子。
随机磁带为在前一轮中要求随机性的罐（智能合约）生成唯一的随机值。这些值被隐藏，直到块被最终确定，防止篡改或利用。
将随机值输出与下一轮共识绑定，确保当前的随机性无法预测未来的输出，从而增强了安全性和完整性。
公开发布：生成的随机性作为随机信标的一部分发布在链上，允许任何人透明地验证和使用它。
这种去中心化的方法消除了对链外随机性提供商的依赖，ICP 利用阈值加密技术以去中心化和安全的方式生成随机性。主要方面包括:

 不可预测： 随机性来自网络子网节点创建的阈值签名。由于这些签名是加密聚合的结果，因此任何一个节点都无法预测或控制输出。
共识： 随机性是子网中子集节点之间协议的产物。这确保了没有任何一个实体能对随机输出产生偏差。
防篡改： 加密过程可确保在容错阈值以下，任何单个节点或恶意节点串通的子集都无法操纵随机性。
Dapps 如何利用这项独特的技术
ICP 的随机性机制是其可扩展性、安全性和去中心化设计的核心，提供不可预测和可验证的随机值，以支持各种应用和共识机制。

以太坊生态系统的随机性依赖于区块哈希或外部神谕（如 Chainlink VRF），与之不同，ICP 的方法是原生的、去中心化的和加密安全的。这就避免了引入第三方依赖性或与链上确定性相关的漏洞。

由 ICP 生成的随机性可应用于多个领域：

动态NFT和游戏：想象一下那些战利品掉落透明且随机的游戏，或是属性不断演化的NFT。ICP的随机性为这些下一代应用提供了完美的支撑。
预测市场和DeFi：在预测市场中，随机性可以用来解决争议或公平处理边缘案例。同样，DeFi平台也可以利用随机性进行随机奖励或治理决策。
DAO治理：随机性可实现投票权的公平分配或确定提案的优先次序，提高分散治理的透明度和效率，并确保公平、不可预测的赌注奖励。
AI和随机性：AI与区块链随机性的结合是一个具有巨大潜力的前沿领域。以下是它们如何整合的方法：
动态AI模型：人工智能驱动的代理可以利用随机性做出更稳健、更不可预测的决策，比如动态定价或资源分配。
公平解决争议：当人工智能模型得出相互矛盾的结论时，随机性可以引入一种中立的仲裁机制，确保公平性。
自治系统：基于链的人工智能系统可以利用随机性引入行为的可变性，使它们在复杂的环境中更加通用。
结论
ICP 的独特随机性机制植根于阈值密码学，提供了一种安全、去中心化和可验证的解决方案，增强了信任度，提高了效率。它的设计与协议更广泛的目标--可扩展性、高性能和公平参与--非常吻合，使其在区块链生态系统中脱颖而出。当然，我们也看到了一些挑战，比如容错，它需要子网中最少数量的诚实节点来维护安全。

参考资料
https://internetcomputer.org/docs/current/motoko/main/base/Random
https://chain.link/vrf
https://github.com/quintolet/randomness-oracle
作者声明：本博客发布内容均为作者本人学习思考，不作为任何投资参考。

每周ICP资讯订阅 | Twitter | 网站
研究员推号：@TQ2050
