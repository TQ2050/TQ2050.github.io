---
layout:       post
title:        "ICP 的 HTTP 外部调用和 Chainlink 预言机解决方案的深度分析"
published:    true
date:         2024-10-17
author:       "TQ2050"
header-style: text
catalog:      false
tags:
    - ICP
    - Chinlink
    - HTTP Call
    - Oracle
---

> 了解 Internet Computer 的直接 Web2 集成如何简化成本敏感型低延迟应用的数据检索。

### **要点总结**

1. **ICP** 通过 HTTP 外部调用使智能合约（canisters）能够直接与 Web2 服务交互，从而简化外部数据的获取，无需第三方预言机，提供低成本、低延迟的解决方案。
2. **Chainlink** 通过去中心化预言机网络，结合多节点数据聚合和共识机制，确保数据的高可靠性和安全性，适用于复杂、高价值的应用场景，但成本较高。
3. ICP 注重简便性和高效性，适合轻量级、低延迟的场景；而 Chainlink 强调去中心化和稳健性，适合需要信任最小化的数据密集型应用。

区块链技术与现实世界数据的整合是实现去中心化应用（dApps）的关键。但如何实现链上智能合约与链下数据源的交互，是一个主要挑战。DFINITY 基金会开发的 **Internet Computer (ICP)**，通过名为 **HTTP 外部调用** 的功能，解决了这一问题。传统区块链生态系统通常依赖于第三方预言机解决方案，例如 **Chainlink**，来填补链上与链下的鸿沟。本文将探讨 ICP 的 HTTP 外部调用和 Chainlink 的预言机解决方案的工作原理，并比较它们的机制、效率、成本和集成的便捷性。

### **1. ICP 的 HTTP 外部调用**

HTTP 外部调用允许 ICP 智能合约（“canisters”）直接发送 HTTP 请求到外部 Web2 服务并接收响应。这一内置功能消除了连接链上和链下数据源时对外部预言机的需求。

#### **ICP HTTP 外部调用的关键要素：**

- **直接交互**：canisters 可无缝访问实时的外部数据。
- **基础架构**：外部调用通过边界节点（boundary nodes）运行，这些节点处理来自 canisters 的 HTTP 请求并将响应返回。

#### **工作流程：**

1. **请求初始化**：通过管理 canister API 中的 http_request 方法触发 HTTP 请求。
2. **临时存储**：请求临时存储在子网的复制状态中，确保冗余。
3. **执行**：子网中的每个副本通过沙箱隔离的适配器组件发送请求。
4. **共识处理**：子网副本通过共识机制验证响应，至少三分之二的副本必须达成一致。
5. **响应交付**：验证完成后，响应被发送回原始 canister。

边界节点在确保外部交互的安全性和数据完整性方面发挥了关键作用，同时通过加密验证来维持信息的安全流动。

![img](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcOOGVoUGhmzXlbps6GBODk8aXidwv3sk3flxtEEI2Kd4efFT0ZFvU0oRrxQ9ujRQwuyJPC0bJn-LhmM5EyMtg9_V2CTQ6iIJ2FeecbSAxJhICuV0y8Qwa8JHNC2DcKiT033dfBsA?key=QXSq7mY42uGPjhR_5DsX-hUk)

Source：https://internetcomputer.org/docs

### **2. Chainlink 的预言机解决方案**

Chainlink 提供了一个去中心化的预言机网络，用于连接区块链智能合约和外部数据源。其架构由以下三个主要部分组成：

1. **预言机节点网络**：由分布式节点组成，独立地检索并将数据传递到区块链，确保对单点故障的抗性。
2. **共识协议**：通过聚合合约验证多个节点的响应，确定最可靠的数据。
3. **链下报告 (OCR)**：节点链下达成共识以降低成本和拥堵，结果随后提交到链上。

#### **数据交换流程：**

1. 智能合约请求外部数据。
2. 预言机节点根据指定从 API 或数据源获取数据。
3. 节点链下达成共识，生成汇总报告。
4. 报告提交到链上，并通过聚合合约验证。

尽管结构复杂，Chainlink 通过多节点操作和聚合机制确保了安全可靠的数据交换，但也因此带来了较高的成本和复杂性。

### **3. ICP HTTP 外部调用与 Chainlink 的对比**

上述两章内容对以chainlink为代表的Oracle，以及前面描述的ICP HTTP Outcall功能做了简要介绍。下面我们将使用下表以多种方式比较ICP HTTP外呼与Chainlink：

| **比较维度**   | **Chainlink**                                                | **ICP HTTP Outcalls**                                        |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 技术架构       | 去中心化预言机网络，使用模块化适配器将链上智能合约与链下数据连接。 | Canister 直接发起 HTTP 请求，无需中间层，简化数据获取流程。  |
| 共识机制       | 多节点响应系统，链下通过拜占庭容错机制聚合数据，链上验证作为最终保障，用于高价值任务和仲裁争议。 | 基于 ICP 的原生共识协议，通过 subnet replica 验证 HTTP 响应的一致性。 |
| 节点参与       | 多个节点（5–31+）负责数据查询、计算聚合结果并将结果上链。    | 不需要独立预言机节点，replica 获取数据并验证一致性，所有操作在 canister 内完成。 |
| 外部数据提供者 | 依赖外部数据提供者（节点运营商）从 Web2 数据源获取数据，形成初始信任模型。 | 假设 Web2 HTTP 服务是可信的，通过 subnet replica 验证外部数据的可靠性。 |
| 第三方依赖     | 依赖中间层（Chainlink 节点运营商）。                         | 不需要第三方中间层，直接通过 HTTP Outcalls 与 Web2 服务交互。 |
| 数据聚合方式   | 链上验证和聚合，成本和延迟较高；链下基于 Schnorr 签名的共识机制降低成本，确保追溯和抗作弊能力。 | 无需复杂的链上聚合，通过轻量智能合约接收 HTTP 响应，适合轻量场景。 |
| 数据差异处理   | 通过共识机制对数据聚合减少偏差。                             | 如果 HTTP 响应不一致，通过 transform 函数消除差异，确保一致性。 |
| 数据验证       | 内置跨节点验证，聚合合约增加信任，减少篡改风险。             | 自定义验证逻辑由 canister 实现，通过 transform 函数处理差异，确保一致性。 |
| 节点诚实性假设 | 假设至少 2/3 的 Chainlink 节点是诚实的。                     | 假设至少 2/3 的 ICP subnet replicas 是诚实的。               |
| 可信基础设施   | 依赖节点运营商，使用可信硬件（如 Intel SGX）和先进加密技术确保隐私和抗篡改能力。 | 依赖分布式共识协议验证 HTTP 响应，无需额外硬件。             |
| 防止搭便车行为 | 通过延迟结果披露机制防止节点搭便车。                         | 假设数据源可靠，无搭便车问题。                               |
| 多数据源支持   | 原生支持多个数据源，通过节点聚合提高准确性。                 | 不支持原生多数据源，但可通过 transform 函数实现类似功能。    |
| 凭证泄露风险   | 使用 Threshold TLS 加密技术和可信硬件（如 Intel SGX），减少泄露风险。 | 使用 Threshold BLS 加密技术，通过多副本生成一致性响应，防止单一副本泄露或篡改数据。 |
| 开发复杂度     | 开发者需要选择节点运营商并配置数据聚合逻辑，增加复杂性。     | 开发者直接调用 HTTP Outcall API 并定义 transform 函数，简化开发流程。 |
| 成本           | 多节点操作和数据聚合导致成本较高。                           | 直接请求和 canister 内部计算成本低，适合轻量场景。           |
| 响应时间       | 数据查询通过节点和区块链网络传递，引入延迟，尤其是多节点场景下。 | 与 Web2 服务直接通信，延迟低，适合实时场景。                 |
| 容错性         | 当少于 1/3 的节点是恶意时，系统仍然可用。                    | 当少于 1/3 的副本是恶意时，仍能保持一致性，但 POST 请求可能受单个恶意副本影响。 |
| 恶意行为防护   | 提供经济激励和惩罚机制，防止节点恶意行为。                   | 需要高级缓解技术（如 Threshold BLS 或子网签名）防止恶意篡改 HTTP 请求。 |
| 数据隐私保护   | 使用可信硬件和零知识证明技术（如 Deco）确保隐私和抗篡改能力。 | 当前未明确强调隐私保护功能。                                 |

该表揭示了将链下数据集成到区块链系统中的两种不同的设计理念：

- Chainlink：去中心化和稳健性

Chainlink优先考虑去中心化和信任最小化。其多节点架构和混合共识机制确保了数据的准确性、安全性和抗篡改性。这种方法非常适合数据可靠性和完整性至关重要的高价值应用程序，但它的代价是更高的复杂性、操作成本和延迟。

- ICP HTTP呼出：简单和高效

ICP HTTP呼出侧重于通过容器直接与Web2服务交互来简化数据采集。这种设计减少了基础设施需求，并针对低成本、低延迟的用例进行了优化。然而，它依赖于Web2数据提供者的可信度假设，使其更适合轻量级应用程序。

### **4. 总结**

根据上面的对比，我们可以看到，Chainlink 是一个去中心化的预言机网络，主要通过外部节点（即预言机节点）聚合来自多个数据源的信息。这使得它特别适合处理需要整合多个数据源的复杂应用场景，尤其是在金融领域中，它能够提供可信的多数据源聚合结果。例如，Chainlink 可以从多个金融市场拉取数据，确保数据的准确性和一致性。通过链下共识（OCR）机制和链上验证的结合，Chainlink 实现了高效且安全的数据聚合，同时防止了节点作恶和数据篡改。然而，由于其依赖多个外部节点，Chainlink 的信任模型相对复杂，且其在数据聚合和存储等方面的成本较高，这对于某些对成本敏感的应用场景可能不是最佳选择。Chainlink 更适合那些需要集成多个数据源、确保数据可靠性的复杂应用，尤其是当这些应用面临金融或其他关键任务时。虽然它提供了强大的安全性和信任保障，但成本较高，且信任模型复杂。

相比之下，而 ICP 则更适合那些对延迟和成本极为敏感的应用，尤其是当数据交互不需要依赖多个外部数据源时，它通过内建的分布式共识和 HTTP Outcalls 提供了一个简单且高效的解决方案。ICP 通过内置的 **HTTP Outcalls** 功能直接与 Web2 服务进行交互，不需要依赖第三方节点。通过其强大的分布式共识机制（Threshold BLS 签名技术），ICP 可以确保从外部服务获取的数据安全且经过验证。这种机制对于开发者来说非常友好，因为它简化了数据获取过程，降低了对外部服务和节点的依赖，因此适合需要低延迟且对成本敏感的应用场景。ICP 的架构让开发者能够直接从 canister 中发起请求并进行数据验证，减少了中介和数据聚合的开销，适合用于轻量级、快速响应的应用。尽管 ICP 在数据聚合的多样性方面不如 Chainlink 强大，但它在快速、安全的 Web2 数据交互中表现突出，特别适合对延迟要求较高的应用。

### **引用**

1. https://internetcomputer.org/docs/current/references/https-outcalls-how-it-works
2. https://blog.csdn.net/wuzhengfei1112/article/details/113784102
3. https://docs.chain.link/
4. https://research.chain.link/whitepaper-v2.pdf


**关注我们**

**每周ICP资讯订阅：**[**@WeekinICP**](https://x.com/Week_ICP)

**研究员X号：**[**@TQ2050**](https://x.com/TQ2050)


**声明：**

本文提供的研究、分析和内容仅代表个人想法和观点，仅供参考，不应被视为财务或投资建议。我们鼓励读者在做出任何投资决定之前，自行进行研究并咨询财务顾问。
